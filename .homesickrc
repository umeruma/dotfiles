#!/usr/bin/env ruby
# generated by LLM on 20251006
# .homesickrc - homesick compatible setup script
# This script runs after 'homesick rc dotfiles'

require 'rbconfig'

def puts_info(message)
  puts "\e[34m[INFO]\e[0m #{message}"
end

def puts_success(message)
  puts "\e[32m[SUCCESS]\e[0m #{message}"
end

def puts_error(message)
  puts "\e[31m[ERROR]\e[0m #{message}"
end

def macos?
  RbConfig::CONFIG['host_os'] =~ /darwin/
end

def linux?
  RbConfig::CONFIG['host_os'] =~ /linux/
end

puts_info "Starting dotfiles setup..."

# Common setup
if File.exist?('./init/setup.sh')
  puts_info "Running common setup script..."
  if system('bash ./init/setup.sh')
    puts_success "Common setup completed"
  else
    puts_error "Common setup failed"
  end
end

# macOS specific setup
if macos?
  puts_info "Detected macOS - running macOS specific setup..."
  
  # Install Homebrew packages
  if File.exist?('./macos/Brewfile')
    puts_info "Installing Homebrew packages..."
    if system('brew bundle --file=./macos/Brewfile')
      puts_success "Homebrew packages installed"
    else
      puts_error "Homebrew bundle installation failed"
    end
  end
  
  # Apply macOS defaults
  if File.exist?('./macos/defaults.sh')
    puts_info "Applying macOS defaults settings..."
    if system('bash ./macos/defaults.sh')
      puts_success "macOS defaults applied"
    else
      puts_error "macOS defaults application failed"
    end
  end
  
  # Install Terminal theme
  if File.exist?('./macos/BirdsOfParadise.terminal')
    puts_info "Installing Terminal theme..."
    if system('open ./macos/BirdsOfParadise.terminal')
      puts_success "Terminal theme opened - please set as default manually"
    else
      puts_error "Failed to open Terminal theme"
    end
  end
end

# Linux specific setup
if linux?
  puts_info "Detected Linux - running Linux specific setup..."
  
  # Run Linux initialization
  if File.exist?('./init/init-linux.sh')
    puts_info "Running Linux initialization..."
    if system('bash ./init/init-linux.sh')
      puts_success "Linux initialization completed"
    else
      puts_error "Linux initialization failed"
    end
  end
  
  # Install Linux packages
  if File.exist?('./linux/Brewfile')
    puts_info "Installing Linux packages..."
    if system('brew bundle --file=./linux/Brewfile')
      puts_success "Linux packages installed"
    else
      puts_error "Linux package installation failed"
    end
  end
  
  # Install Hugo (if needed)
  puts_info "Installing Hugo..."
  if system('sudo apt-get install hugo')
    puts_success "Hugo installed"
  else
    puts_error "Hugo installation failed"
  end
end

puts_success "Dotfiles setup completed!"
puts_info "You may need to restart your shell or source your shell configuration files."